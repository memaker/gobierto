<header class="place">
  <div class="breadcrumb">
    <%= link_to @place.province.autonomous_region.name %> >
    <%= link_to @place.province.name %>
  </div>
  <h1><%= @place.name %></h1>
  <menu>
    <ul>
      <li><%= link_to 'Presupuesto' %></li>
      <li><%= link_to 'Ejecución' %></li>
      <li><%= link_to 'Indicadores' %></li>
      <li><%= link_to 'Rankings' %></li>
      <li><%= link_to 'Contexto' %></li>
    </ul>
  </menu>
</header>

<div class="main_metrics clearfix">

  <div class="metric" data-graph-show="1">
    <div class="label">Gasto total</div>
    <div class="main">128,4M€</div>
    <div class="secondary">
      <div class="percentage_change up">3,23%</div>
      <div class="ranking"><strong>#12</strong>/8.234</div>
    </div>
  </div>

  <div class="metric selected" data-graph-show="2">
    <div class="label">Habitantes</div>
    <div class="main">1.234</div>
    <div class="secondary">
      <div class="percentage_change down">1,23%</div>
      <div class="ranking"><strong>#12</strong>/8.234</div>
    </div>
  </div>

  <div class="metric" data-graph-show="3">
    <div class="label">Wadus</div>
    <div class="main">1.234</div>
    <div class="secondary">
      <div class="percentage_change down">1,23%</div>
      <div class="ranking"><strong>#12</strong>/8.234</div>
    </div>
  </div>

  <div class="metric" data-graph-show="4">
    <div class="label">Wadus</div>
    <div class="main">1.234</div>
    <div class="secondary">
      <div class="percentage_change down">1,23%</div>
      <div class="ranking"><strong>#12</strong>/8.234</div>
    </div>
  </div>

  <div class="metric" data-graph-show="5">
    <div class="label">Gasto por habitante</div>
    <div class="main">1.234€</div>
    <div class="secondary">
      <div class="percentage_change down">1,23%</div>
      <div class="ranking"><strong>#12</strong>/8.234</div>
    </div>
  </div>

</div>

<div class="metric_graphs">

  <div class="graph" data-graph-cont="1">

    graph gasto total

  </div>

  <div class="graph" data-graph-cont="2">

    graph habitantes 

  </div>

  <div class="graph" data-graph-cont="3">

    graph wadus

  </div>

  <div class="graph" data-graph-cont="5">

    graph gasto por habitante

  </div>

</div>

<div class="section_separator" name="separator">
  <div class="sep"></div>
  Explora ingresos y gastos de El Ejido
  <div class="sep"></div>
</div>

<div class="ie_intro">

  <div class="col-1-2 income">
    
    <header class="cat">
      <h2>Ingresos</h2>
      <div class="qty"><%= number_to_currency @income_lines['aggregations']['total_budget']['value'], precision: 0 %></div>
    </header>

    <div class="graph" id="income-treemap" data-url="<%= api_data_treemap_path(@place.id, 'economic', 2015, BudgetLine::INCOME, 1, format: :json) %>"></div>

    <div class="items">
      <table>
        <% @income_lines['hits'].each do |budget_line| %>
          <tr>
            <td><%= EconomicArea.all_items['I'][budget_line['code']] %></td>
            <td class="right amount"><%= number_to_currency budget_line['amount'], precision: 0 %></td>
            <td class="right"><strong><%= percentage_of_total(budget_line['amount'], @income_lines['aggregations']['total_budget']['value']) %>%</strong></td>
            <td><div class="bar percent-<%= percentage_of_total(budget_line['amount'], @income_lines['aggregations']['total_budget']['value']).to_i %>"></div></td>
          </tr>
        <% end %>
      </table>
  
      <div class="show_all">
        <a href="municipio_cat" class="list_view_more">Ver desglose de ingresos</a>
      </div>
      
    </div>
  </div>

  <div class="col-2-2">

    <header class="cat expenses">
      <h2>Gastos</h2>

      <div class="form_filters">
        <ul>
          <li><%= link_to 'Económica', place_path(@place.slug, {area: 'economic'}) + '#switch', 
                  class: ("buttonSelected" if @area_name == 'economic'), name: 'switch' %>
          </li>
          <li><%= link_to 'Funcional', place_path(@place.slug, {area: 'functional'}) + '#switch',
                  class: ("buttonSelected" if @area_name == 'functional') %>   
          </li>
        </ul>
      </div>

      <div class="qty"><%= number_to_currency @expense_lines['aggregations']['total_budget']['value'], precision: 0 %></div>
    </header>

    <div class="graph" id="expense-treemap" data-url="<%= api_data_treemap_path(@place.id, @area_name, 2015, BudgetLine::EXPENSE, 1, format: :json) %>"></div>

    <div class="items">
      <table>
        <% @expense_lines['hits'].each do |budget_line| %>
          <tr>
            <td><%= budget_line_denomination @area_name, budget_line['code'],'G' %></td>
            <td class="right amount"><%= number_to_currency budget_line['amount'], precision: 0 %></td>
            <td class="right"><strong><%= percentage_of_total(budget_line['amount'], @expense_lines['aggregations']['total_budget']['value']) %>%</strong></td>
            <td><div class="bar percent-<%= percentage_of_total(budget_line['amount'], @expense_lines['aggregations']['total_budget']['value']).to_i %>"></div></td>
          </tr>
        <% end %>
      </table>

      <div class="show_all">
        <a href="municipio_cat" class="list_view_more">Ver desglose de gastos</a>
      </div>

    </div>

  </div>

</div>


<script>
$(function(){
  var incomeTreemap = new TreemapVis('#income-treemap');
  incomeTreemap.render($('#income-treemap').data('url'));

  var expenseTreemap = new TreemapVis('#expense-treemap');
  expenseTreemap.render($('#expense-treemap').data('url'));
});
</script>
