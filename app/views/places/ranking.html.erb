<% set_meta_tags title: "Ránking (TODO)" %>

<header class="table">
  <div class="breadcrumb">
    <%= link_to 'Ranking' %>
  </div>
  <h1>
    <span>
      <div class="switcher kind_switcher">
        <%= link_to "#{kind_literal(@kind).capitalize} <i class='fa fa-angle-down'></i>".html_safe, '', class: 'current' %>
        <ul>
          <li><%= link_to kind_literal(@kind).capitalize, places_ranking_path(@year, @code, @kind, @area_name) %></li>
          <li><%= link_to kind_literal(other_kind(@kind)).capitalize, places_ranking_path(@year, @code, other_kind(@kind), @area_name) %></li>
        </ul>
      </div>

      <% (1..@compared_level + 1).each do |level| %>
        <span class="sep"> » </span>
    </span>

    <span>
      <div class="switcher kind_switcher">
        <%
        selected_branch_code = @code[0...level]
        if level == @compared_level + 1
          previous_branch_code = @code
          current_link_literal = "Total"
        else
          previous_branch_code = selected_branch_code[0...level-1]
          current_link_literal = budget_line_denomination(@area_name, selected_branch_code, @kind, 20)
        end
        items = categories_in_level(@area_name, @kind, level, previous_branch_code)
        %>

        <%= link_to "#{current_link_literal} <i class='fa fa-angle-down'></i>".html_safe, places_ranking_path(@year, selected_branch_code, @kind, @area_name), class: 'current' %>
        <% if items.any? %>
          <ul>
            <% items.each do |code, name| %>
              <li><%= link_to budget_line_denomination(@area_name, code, @kind), places_ranking_path(@year, code, @kind, @area_name) %></li>
            <% end %>
          </ul>
        <% end %>
      </div>
    <% end %>
    </span>
  </h1>

  <% if @kind == 'G' %>
    <div class="form_filters">
      <ul>
        <li><%= link_to 'Económica', places_ranking_path(@year,@code,@kind,'economic'), class: "#{'buttonSelected' if @area_name == 'economic'}" %></li>
        <li><%= link_to 'Funcional', places_ranking_path(@year,@code,@kind,'functional'), class: "#{'buttonSelected' if @area_name == 'functional'}" %></li>
      </ul>
    </div>
  <% end %>

</header>

<div class="">
  <table class="data_table">
  <thead>
    <th class="r_pos">#</th>
    <th class="location">Municipio</th>
    <th class="population">Habitantes</th>
    <th class="expense_per" title="Gasto por habitante">Gasto/hab</th>
    <th class="relative_pos"></th>
    <th class="expense">Gasto total</th>
    <th class="percentage">% s/ Total</th>
    <th class="relative_pos"></th>
    <th class="compare">Compara</th>
  </thead>

  <tbody>
    <% @places_data.each_with_index do |place_data, i| %>
      <% place = INE::Places::Place.find(place_data['ine_code']) %>
      <tr>
        <td class="r_pos"><%= ranking_position(i, @page, @per_page) %>.</td>
        <td class="location"><a href="#"><%= place.name %></a> (<%= place.province.name %>)</td>
        <td class="population"><%= number_with_precision place_data['population'], precision: 0, delimiter: '.' %></td>
        <td class="expense_per"><%= number_to_currency place_data['amount_per_inhabitant'] %></td>
        <td class="relative_pos tipsit" title="98%"><div class="relative"><span style="left:98%"></span></div></td>
        <td class="expense"><%= number_to_currency place_data['amount'] %></td>
        <td class="percentage">23,4%</td>
        <td class="relative_pos tipsit" title="50%"><div class="relative"><span style="left:50%"></span></div></td>
        <td class="compare">Compara</td>
      </tr>
    <% end %>
  </tbody>
  </table>

  <%= paginate @places_data %>

</div>
