<%= link_to 'Resetear', budgets_path %>

<br>

<%= form_tag budgets_path, method: :get do %>

  <%= label_tag :place, 'Municipio' %>
  <%= select_tag :place, options_for_select(INE::Places::Place.all.map{|p| [p.name, p.id]}, params[:place]), class: 'select2', prompt: 'Todos' %>

  <br>

  <%= label_tag :functional_area, 'Area funcional' %>
  <%= select_tag :functional_area, options_for_select(FunctionalArea.items_for_select, params[:functional_area]), prompt: 'Total', class: 'select2' %>

  <br>

  <%= label_tag :economic_area, 'Area econ칩mica' %>
  <%= select_tag :economic_area, options_for_select(EconomicArea.items_for_select, params[:economic_area]), prompt: 'Total', class: 'select2' %>

  <br>
 
  <%= label_tag :kind, 'Tipo' %>
  <%= select_tag :kind, options_for_select(EconomicArea.kinds, params[:kind]) %>

  <br>

  <%= label_tag :year, 'A침o' %>
  <%= select_tag :year, options_for_select(BudgetFilter.years, params[:year]) %>

  <br>

  <%= label_tag :size, 'Tama침o' %>
  <%= select_tag :size, options_for_select(BudgetFilter.populations, params[:size]), prompt: 'Todos' %>

  <br>

 <%= submit_tag 'Filtrar' %>
<% end %>

<div>
  <% if @budget_lines && @budget_lines.any? %>
    <table>
      <theader>
        <tr>
          <th></th>
          <% if @filter.global? %>
            <th>C칩d. Partida</th>
            <th>Partida</th>
          <% else %>
            <th>Municipio</th>
            <th>Habitantes</th>
          <% end %>
          <th>Gasto/Hab</th>
          <th>Gasto</th>
          <th>% S/Total</th>
          <th></th>
        </tr>
      </theader>
      <tbody>
        <% @budget_lines.each do |budget_line| %>
          <tr>
            <td class="sparkline" data-sparkvalues='<%= budget_line.historic_values.join(',') %>'></td>
            <% if @filter.global? %>
              <td><%= budget_line.code %></td>
              <td><%= budget_line.name %></td>
            <% else %>
              <td><%= budget_line.place_name %></td>
              <td><%= budget_line.population.total %></td>
            <% end %>
            <td><%= money(budget_line.amount / budget_line.population.total) %></td>
            <td><%= money(budget_line.amount) %></td>
            <td><%= percentage(budget_line.amount, budget_line.place.total_budget) %></td>
            <td><%= link_to 'Compara', '' %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</div>
