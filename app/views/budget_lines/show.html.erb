<%
set_meta_tags title: "Presupuesto de #{@place.name} » #{kind_literal(@kind).capitalize} » #{budget_line_denomination(@area_name, @code, @kind)}"
@share_text = "#{kind_literal(@kind, false).capitalize} municipal en #{budget_line_denomination(@area_name, @code, @kind)} de #{@place.name} para el #{@year} by @gobierto. #{request.original_url}"
%>

<%= render partial: 'places/place_header' %>

<header class="sub ">

  <span class="sep"><%= link_to kind_literal(@kind).capitalize, place_budget_path(@place.slug, @year, @kind, @area_name) %> »</span>
  <%= render partial: 'breadcrumb',
            collection: budget_line_crumbs(@parent_line, @area_name),
            as: 'budget_line',
            spacer_template: 'breadcrumb_spacer' %>

</header>

<div class="main_metrics clearfix">
  <div class="metric selected tipsit" data-widget-template="#widget-template"
                             title="<%= kind_literal(@kind, false).humanize %> total de esta partida en este año por habitante"
                             data-widget-type="per_person"
                             data-line-widget-series="means"
                             data-line-widget-url="<%= api_data_lines_budget_line_path(@place.id, @year, "per_person", @kind, @code, @area_name, format: :json ) %>"
                             data-line-widget-type="per_person"
                             data-widget-data-url="<%= api_data_budget_per_inhabitant_path(ine_code: @place.id, year: @year, kind: @kind, code: @code, area: @area_name, format: :json) %>">
  </div>

  <div class="metric tipsit" data-widget-template="#widget-template"
                                      title="<%= kind_literal(@kind, false).humanize %> total de esta partida en este año"
                                      data-widget-type="budget"
                                      data-line-widget-series="means"
                                      data-line-widget-url="<%= api_data_lines_budget_line_path(@place.id, @year, "total_budget", @kind, @code, @area_name, format: :json ) %>"
                                      data-line-widget-type="total_budget"
                                      data-widget-data-url="<%= api_data_budget_path(ine_code: @place.id, year: @year, kind: @kind, code: @code, area: @area_name, format: :json) %>">
  </div>

  <div class="metric" data-widget-template="#small-widget-template"
                      data-widget-type="budget_percentage_over_total"
                      data-widget-data-url="<%= api_data_budget_percentage_over_total_path(ine_code: @place.id, year: @year, kind: @kind, code: @code, area: @area_name, format: :json) %>">
  </div>

  <div class="metric" data-widget-template="#small-widget-template"
                      data-widget-type="budget_percentage_over_province"
                      data-widget-data-url="<%= api_data_budget_percentage_over_province_path(ine_code: @place.id, year: @year, kind: @kind, code: @code, area: @area_name, format: :json) %>">
  </div>

  <div class="metric cta">
    <%= link_to 'Levanta la mano <i class="fa fa-hand-paper-o"></i>'.html_safe, 'javascript:void(0);', onclick: "$('.metric_graphs').hide(); $('.budget_line_feedback').show();" %>
    
  </div>
</div>

<div class="metric_graphs clearfix">
  <div class="widget_graph show clearfix">
    <div id="lines_chart"></div>
    <div id="lines_tooltip"></div>
  </div>
</div>


<div class="widget_graph budget_line_feedback hidden">

  <div class="blf_question_1 ">

    <p>¿Entiendes de qué va esta partida?</p>

    <div class="options yes_no">

      <%= link_to 'Si', 'javascript:void(0)', class: 'button', onclick: "$('.blf_question_1').hide(); $('.blf_question_2').show(); " %>
      <%= link_to 'No', 'javascript:void(0)', class: 'button', onclick: "$('.blf_question_1').hide(); $('.blf_reply_1').show(); " %>

    </div>

  </div>

  <div class="blf_question_2 hidden">

    <p>¿Crees que la cantidad de gasto es apropiada?</p>

    <div class="options ">

      <%= link_to 'Me parece <span>POCO</span>'.html_safe, 
        'javascript:void(0)', class: 'button', onclick: "$('.blf_question_2').hide(); $('.blf_question_3').show(); " %>
      <%= link_to 'Me parece <span>Apropiado</span>'.html_safe, 
        'javascript:void(0)', class: 'button', onclick: "$('.blf_question_2').hide(); $('.blf_question_3').show(); " %>
      <%= link_to 'Me parece <span>mucho</span>'.html_safe, 
        'javascript:void(0)', class: 'button', onclick: "$('.blf_question_2').hide(); $('.blf_question_3').show(); " %>

      <p>(<%= link_to 'next'.html_safe, 
        'javascript:void(0)', onclick: "$('.blf_question_2').hide(); $('.blf_reply_2').show(); " %>)</p>

    </div>

  </div>

  <div class="blf_question_3 hidden">

    <p>¿Cómo te hacen sentir estas cantidades?</p>

    <div class="options ">

      <%= link_to 'Feliz', '', class: 'button' %>
      <%= link_to 'Indignado', '', class: 'button' %>
      <%= link_to 'Esperanzado', '', class: 'button' %>
      <%= link_to 'Triste', '', class: 'button' %>
      <%= link_to 'Orgulloso', '', class: 'button' %>
      <%= link_to '+', '', class: 'button' %>

      <p>(<%= link_to 'next'.html_safe, 
        'javascript:void(0);', onclick: "$('.blf_question_3').hide(); $('.blf_reply_2').show(); " %>)</p>

    </div>

  </div>


  <div class="blf_reply_1 hidden">

    <p>¿Entiendes de qué va esta partida?</p>

    <div class="reply">
      <div class="inner">

        <p>Puedes solicitar a tu alcalde que amplie la información sobre esta y otras partidas</p>

        <form>
          <input type="text" value="" placeholder="Tu correo-e">
          <%= link_to 'Solicitar', 'javascript:void(0);', class: 'button', onclick: "$('.blf_reply_1 form').hide(); $('.blf_reply_1 .share_post_submit').show(); " %>
          <div class="exp">
            <p>Para informarte cuando haya respuesta, y para que acccedas a otras herramientas de Gobierto. No spam, info privada <%= link_to 'Más información' %></p>
          </div>
        </form>

        <div class="share_post_submit hidden">
          <p><small>Comprueba tu correo para confirmar tu acción</small></p>
          <p><small>
            ¿Quieres que tus vecinos también soliciten más información a tu alcalde en
            <%= link_to 'Twitter', "https://twitter.com/home?status=#{u @share_text}", class: 'small_button popup' %>
            <%= link_to 'Facebook', "http://www.facebook.com/sharer/sharer.php?u=#{u @share_text}", class: 'small_button popup' %>
            ?
          </small></p>
        </div>

      </div>
    </div>

  </div>

  <div class="blf_reply_2 hidden">

    <p>¿Crees que la cantidad de gasto es apropiada?</p>

    <div class="reply">
      <div class="inner">

        <p>Gracias por tu opinión. Esta es lo que piensa el resto de la gente que ha opinado:</p>

        <p>
          <div class="button empty">24% <span>Poco</span></div>
          <div class="button empty">12% <span>Apropiado</span></div>
          <div class="button empty">67% <span>Mucho</span></div>
        </p>

        <div class="sep"></div>

        <form>
          <p><small>Puedes seguir esta partida para recibir noticias ocasionales sobre su evolución y opiniones:</small></p>
          <input type="text" value="" placeholder="Tu correo-e">
          <%= link_to 'Seguir', 'javascript:void(0);', class: 'button', onclick: "$('.blf_reply_2 form').hide(); $('.blf_reply_2 .share_post_submit').show(); " %>
          <div class="exp">
            <p>No spam, tus opiniones serán siempre privadas <%= link_to 'Más información' %></p>
          </div>
        </form>

        <div class="share_post_submit hidden">
          <p><small>Comprueba tu correo para confirmar tu acción</small></p>
          <p><small>
            ¿Quieres compartir esta estadística en
            <%= link_to 'Twitter', "https://twitter.com/home?status=#{u @share_text}", class: 'small_button popup' %>
            <%= link_to 'Facebook', "http://www.facebook.com/sharer/sharer.php?u=#{u @share_text}", class: 'small_button popup' %>
            ?
          </small></p>
        </div>

      </div>
    </div>

  </div>

  



</div>



<div class="items">
  <table>
  <tr>
    <th>
      <input type="text" placeholder="Busca partidas de <%= kind_literal(@kind, true) %>" class="search_items" id="search_categories_budget" data-search-url="<%= search_categories_path(@place.slug,@year,@area_name, @kind) %>">
    </th>
    <th class="right "><%= kind_literal(@kind, false) %> total</th>
    <th class="right "><%= kind_literal(@kind, false) %> por hab.</th>
    <th class="right ">% s/ total</th>
    <th></th>
  </tr>

  <tr>
    <td class="item_name" colspan="4">
      <%= link_to '« Inicio', place_budget_path(@place.slug, @year, @kind, @area_name) %>
    </td>
  </tr>

  <%= render partial: 'places/nested_budget_lines' %>

  </table>
</div>

<script type="text/html" id="widget-template">
  <div class="label">{{title}}</div>
  <div class="main">{{value}}</div>
  <div class="secondary">
    <div class="percentage_change up">{{delta_percentage}}%</div>
    <div class="ranking"><a href="{{ranking_url}}" class="ranking_link"><strong>#{{ranking_position}}</strong>/{{ranking_total_elements}}</a></div>
  </div>
</script>

<script type="text/html" id="small-widget-template">
  <div class="label">{{title}}</div>
  <div class="main">{{value}}</div>
  <div class="secondary">
  </div>
</script>

<div class="item_description">
  <h3>Acerca de esta partida</h3>

  <div class="tabs">
    <ul>
      <li><%= link_to 'Descripción', '', class: 'active', data: { "tab-target": 'description' } %></li>
      <li><%= link_to 'Comentario del Ayuntamiento', '', data: { "tab-target": 'comment' } %></li>
      <li><%= link_to 'Contratos asociados a esta partida', '', data: { "tab-target": 'contracts' } %></li>
      <li><%= link_to 'Preguntas y respuestas', '', data: { "tab-target": 'q&a' } %></li>
    </ul>
  </div>

  <div class="tab_content" data-tab="description">
    <p class="placeholder_no_info">Todavía no hay información.</p>
  </div>

  <div class="tab_content" data-tab="comment" style="display: none;">
    <p class="placeholder_no_info">Pide a tu municipio que incluya esta información.</p>
  </div>

  <div class="tab_content" data-tab="contracts" style="display: none;">
    <p class="placeholder_no_info">Pide a tu municipio que incluya esta información.</p>
  </div>

  <div class="tab_content" data-tab="q&a" style="display: none;">
    <p class="placeholder_no_info">Proximamente.</p>
  </div>

</div>

<%= render 'places/cta_block' %>
