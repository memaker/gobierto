<div class="breadcrumb stick_ip" data-budget-line-breadcrumb="<%= ([@year, @kind].concat(@code.length.downto(1).map{|i| @code[0..-i]})).join('/') %>"
                                 data-budget-line-area="<%= @area_name %>" data-budget-line-categories="<%= gobierto_budgets_api_categories_url(host: Site.budgets_host, format: :json) %>">
  <div class="column">
    <div class="bread_hover">
      <div class="bread_links" data-line-breadcrumb>
      </div>

      <div class="line_browser clearfix">
        <div class="bread_links clearfix" data-line-breadcrumb>
        </div>

        <div class="col" data-level="0">
          <table>
            <% GobiertoBudgets::SearchEngineConfiguration::Year.all.each do |year| %>
              <tr data-code="<%= year %>">
                <td><%= link_to year, gobierto_sites_budgets_path %></td>
              </tr>
            <% end %>
          </table>
        </div>

        <div class="col" data-level="1">
          <table data-current-code=""></table>
        </div>

        <div class="col" data-level="2">
          <table data-current-code=""></table>
        </div>

        <div class="col" data-level="3">
          <table data-current-code=""></table>
        </div>

        <div class="col" data-level="4">
          <table data-current-code=""></table>
        </div>

        <div class="col" data-level="5">
          <table data-current-code=""></table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="column">
  <div class="budget_line">

    <header data-share>
      <h1><%= @budget_line.name %></h1>

      <div class="social_links_container" data-share-text="En @gobierto: <%= @area_name == GobiertoBudgets::BudgetLine::EXPENSE ? 'Gasto' : 'Ingreso' %> municipal de <%= @site.place.name %> en <%= @budget_line.name %> para el <%= @year %>">
        <a href="#" class="social_share twitter" data-share-network="twitter" data-track-event="Social Share|Click Twitter|XXX"><i class="fa fa-twitter"></i></a>
        <a href="#" class="social_share facebook" data-share-network="facebook" data-track-event="Social Share|Click Facebook|XXX"><i class="fa fa-facebook"></i></a>
        <a href="#embed-graph-code" class="code open_modal"><i class="fa fa-code"></i></a>
      </div>

      <%= render partial: 'shared/embed' %>
    </header>

    <div class="separator"></div>

    <div class="pure-g numbers_intro">

      <div class="pure-u-1 pure-u-md-1-2 p_h_l_1">
        <ul>
          <li>Por habitante <strong>nos <%= @area_name == GobiertoBudgets::BudgetLine::EXPENSE ? 'gastamos' : 'ingresamos' %> <span class="highlight"><%= number_to_currency @budget_line_stats.amount_per_inhabitant, precision: 2 %></span></strong>.</li>
          <li>En total son <strong><span class="highlight"><%= format_currency @budget_line_stats.amount %></span></strong>.</li>
          <% if diff = @budget_line_stats.percentage_difference(variable1: :amount_planned, variable2: :amount_executed, year: @year-1) %>
            <li>El año pasado <%= @area_name == GobiertoBudgets::BudgetLine::EXPENSE ? 'gastamos' : 'ingresamos' %> un <span class="highlight"><strong><%= diff %></strong></span> de lo planeado.</li>
          <% else %>
            <li>Hemos <%= @area_name == GobiertoBudgets::BudgetLine::EXPENSE ? 'gastado' : 'ingresado' %> un <span class="highlight"><strong><%= @budget_line_stats.percentage_difference(variable1: :amount_planned, year1: @year, year2: @year-1) %></strong></span> que el año anterior.</li>
          <% end %>
        </ul>
      </div>

      <div class="pure-u-1 pure-u-md-1-2 p_h_r_1 description">
        <% pending do %>
          <p>
            Comprende esta área todos aquellos gastos originados por los
            servicios públicos básicos que, con carácter obligatorio, deben
            prestar los municipios, por sí o asociados, con arreglo al artículo
            26.1 de la Ley 7/1985, de 2 de abril, reguladora de las Bases del Régimen
            Local, o, en su caso, las provincias con arreglo al artículo 31.2 de la
            misma Ley, atendiendo a su función de cooperación y asistencia a los
            municipios. A estos efectos, se incluyen, en los términos que se exponen para
            cada una de ellas, cuatro políticas de gasto básicas: seguridad y movilidad
            ciudadana, vivienda y urbanismo, bienestar comunitario y medio ambiente.
          </p>
        <% end %>
      </div>
    </div>

    <div class="separator"></div>

    <div class="pure-g block">
      <div class="pure-u-1 pure-u-md-1-2 p_h_l_1">
        <h2>Partidas</h2>
        <table>
          <% @budget_line_descendants.each do |budget_line| %>
            <tr>
              <td><%= link_to budget_line.name, gobierto_sites_budget_line_path(budget_line.to_param) %></td>
              <td class="qty"><%= number_with_precision(budget_line.percentage_of_total * 100, precision: 2) + '%' %></td>
              <td class="amount"><%= format_currency(budget_line.amount) %></td>
            </tr>
          <% end %>
        </table>
      </div>

      <div class="pure-u-1 pure-u-md-1-2 p_h_r_1">
        <h2>Distribución de los gastos de esta partida</h2>
        <table>
          <% @budget_line_economic_composition.each do |budget_line| %>
            <tr>
              <td><%= link_to budget_line.name, gobierto_sites_budget_line_path(budget_line.to_param) %></td>
              <td class="qty"><%= number_with_precision(budget_line.percentage_of_total * 100, precision: 2) + '%' %></td>
              <td class="amount"><%= format_currency(budget_line.amount) %></td>
            </tr>
          <% end %>
        </table>
      </div>
    </div>

    <div class="separator"></div>

    <div class="pure-g block" data-vis-lines>
      <div class="pure-u-1 pure-u-md-1-2 p_h_l_1">
        <h2>Evolución</h2>
        <div id="lines_chart"></div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2 p_h_r_1">
        <h2>Contexto</h2>
        <div id="lines_tooltip"></div>
        <div class="help">
          <%= link_to 'Nota sobre los datos'.html_safe, gobierto_budgets_faq_path(anchor: 'no_data'), title: 'La base de datos que utilizamos no incluye datos para el 100% de los municipios, por lo que las medias están calculadas solo con los datos que existen (que son la gran mayoría). Más información en nuestras preguntas frecuentes', class: 'tipsit' %>
        </div>
      </div>

      <div class="pure-u-1">
        <div class="filter m_v_2">

          <%= link_to 'Por habitante', '#', class:'active',  data: {"line-widget-series" => "means", "line-widget-url" => gobierto_budgets_api_data_lines_budget_line_path(@place.id, @year, "per_person", @kind, @code.parameterize, @area_name, format: :json ), "line-widget-type" => "per_person" } %>
          <%= link_to 'En total', '#', class:'',  data: {"line-widget-series" => "means", "line-widget-url" =>gobierto_budgets_api_data_lines_budget_line_path(@place.id, @year, "total_budget", @kind, @code.parameterize, @area_name, format: :json ), "line-widget-type" => "total_budget" } %>
        </div>
      </div>
    </div>
  </div>
</div>
